{% load i18n %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <title>FAST: Gadget Visual Storyboard</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        
        <link rel="shortcut icon" type="image/x-icon" href="{{ MEDIA_URL }}images/gui/favicon.ico" />
        
        <!-- WireIt -->
        <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}js/lib/wireit/lib/yui/fonts/fonts-min.css" /> 
        <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}js/lib/wireit/lib/yui/reset/reset-min.css" />
        <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}js/lib/wireit/css/WireIt.css" />   
        
        <!-- CSS -->
        <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}js/lib/dojo/dijit/themes/soria/soria.css" />
        <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}js/lib/dojo/dojo/resources/dojo.css" />
        <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}style/gvs.css" />                      

        <script type="text/javascript">
        /* <![CDATA[ */
           //Dojo Configuration parameters
            var djConfig = {
                isDebug:false, 
                parseOnLoad:true
            };

            
        /* ]]> */
        </script>
        
        <!-- General utilities -->
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/utils/browserfixes.js"></script>
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/utils/json2.js"></script>    
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/utils/shortcut.js"></script>
               

        <!-- Excanvas -->
        <!--[if IE]><script type="text/javascript" src="./WireIt-0.5.0/lib/excanvas.js"></script><![endif]-->
        
        <!-- WireIt -->
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/wireit/lib/yui/utilities/utilities.js"></script>
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/wireit/js/WireIt.js"></script>
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/wireit/js/Layer.js"></script>
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/wireit/js/Container.js"></script>      
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/wireit/js/CanvasElement.js"></script>
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/wireit/js/Wire.js"></script>
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/wireit/js/Terminal.js"></script>
        
        <!-- Dojo -->
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/dojo/dojo/dojo.js"></script>
        
        <!-- Prototype -->
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/prototype/prototype.js"></script>
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/prototype/prototype.improvements.js"></script>  
        
        <!-- Browser checker -->
        <script type="text/javascript" src="{{ MEDIA_URL }}js/gvs/utils/BrowserChecker.js"></script> 
    
        <!-- Graceful degradation of firebug console --> 
        <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/utils/firebugx.js"></script>      
        
        <!-- URI constants -->
        <script type="text/javascript">
            
            var browser = new BrowserChecker();
            
            var URIs = new Object();
            URIs.store = "storage/";
            // Catalogue URIs
            URIs.catalogue = "catalogue";
            URIs.catalogueScreens = "catalogue/screens";
            URIs.catalogueGetMetadata = "catalogue/getmetadata";
            URIs.catalogueFlow = "check";
            URIs.catalogueCreateScreen = "catalogue/screens";
            URIs.catalogueAllConcepts = "catalogue/concepts";
            URIs.catalogueTagConcepts = "catalogue/tags/<tags>/concepts";
            URIs.cataloguePlanner = "catalogue/planner";
            // Screenflow design
            URIs.catalogueScreenflowFind = "catalogue/screens/find";
            URIs.catalogueScreenflowFindCheck = "catalogue/screens/findcheck";
            URIs.catalogueScreenflowCheck = "catalogue/screens/check";
            // Screen design
            URIs.catalogueScreenFind = "catalogue/components/find";
            URIs.catalogueScreenFindCheck = "catalogue/components/findcheck";
            URIs.catalogueScreenCheck = "catalogue/components/check";
            // GVS
            URIs.buildingblock = "buildingblock";
            URIs.screen = "buildingblock/screen";
            URIs.screenflow = "buildingblock/screenflow";
            URIs.userPreferences = "user/preferences";
            URIs.logoFast = "{{ MEDIA_URL }}images/gui/fastLogo.png";
            URIs.screenImageNotFound = "{{ MEDIA_URL }}images/gui/imageNotFound.png";
            URIs.about = "{{ MEDIA_URL }}resources/about.html";
            URIs.pre = "catalogue/preconditions/";
            URIs.post = "catalogue/postconditions/";
            URIs.ezweb = "{{EZWEB_URL}}";

            var GlobalOptions = new Object();

            // Only include the checked and finished features
            GlobalOptions.isPublicDemo = false;

        </script>

        <!-- GVS Code -->
        <!-- Drag n Drop support -->
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/dragndrop/DragHandler.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/dragndrop/DragSource.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/dragndrop/Area.js"></script>
        
        <!-- Catalogue Classes -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/Catalogue.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/BuildingBlockDescription.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/ScreenDescription.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/DomainConceptDescription.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/catalogue/ScreenflowDescription.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/ResourceDescription.js"></script>
            
        <!-- Inference Engine -->
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/catalogue/inferenceEngine/InferenceEngine.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/catalogue/inferenceEngine/ScreenflowInferenceEngine.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/catalogue/inferenceEngine/ScreenInferenceEngine.js"></script>

        <!-- Factories -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/factories/BuildingBlockFactory.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/factories/ScreenFactory.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/factories/DomainConceptFactory.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/factories/FormFactory.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/factories/OperatorFactory.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/factories/ResourceFactory.js"></script>     

        <!-- Sets -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/sets/BuildingBlockSet.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/sets/DomainConceptSet.js"></script>          
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/catalogue/sets/SetListener.js"></script>

        <!-- Property viewers -->
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/propertiesViewers/Table.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/propertiesViewers/PropertiesPane.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/propertiesViewers/FactPane.js"></script>

        <!-- Toolbar -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/toolbar/Toolbar.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/toolbar/ToolbarModel.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/toolbar/ToolbarButton.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/toolbar/ToolbarDropDown.js"></script>

        <!-- Menu -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/menu/Menu.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/menu/MenuElement.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/menu/MenuAction.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/menu/SubMenu.js"></script>

        <!-- Documents -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/documents/AbstractDocument.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/documents/PaletteDocument.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/documents/WelcomeDocument.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/documents/DocumentController.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/documents/ScreenflowDocument.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/documents/ScreenDocument.js"></script>

        
        <!-- Facts -->
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/facts/Fact.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/facts/FactFactory.js"></script>  
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/facts/FactIcon.js"></script>

        <!-- Component instances -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/instances/ComponentInstance.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/instances/ScreenInstance.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/instances/PrePostInstance.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/instances/ResourceInstance.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/instances/OperatorInstance.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/instances/FormInstance.js"></script>

        <!-- Palette -->
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/palette/Palette.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/palette/PaletteComponent.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/palette/PaletteController.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/palette/ScreenComponent.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/palette/DomainConceptComponent.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/palette/ResourceComponent.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/palette/OperatorComponent.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/palette/FormComponent.js"></script>

        <!-- Building Block Views -->
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/views/BuildingBlockView.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/views/ScreenView.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/views/DomainConceptView.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/views/ResourceView.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/views/OperatorView.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/views/FormView.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/views/FormSnapshotView.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/views/ActionView.js"></script>        

        <!-- Piping -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/piping/Terminal.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/piping/Pipe.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/piping/PipeFactory.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/piping/TriggerMappingFactory.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/piping/Trigger.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/piping/ScreenTrigger.js"></script>

        <!-- Persistence Engine -->
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/persistenceEngine/PersistenceEngine.js"></script>

        <!-- Dialogs -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/dialogs/FormDialog.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/dialogs/ConfirmDialog.js"></script>    
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/dialogs/PrePostDialog.js"></script>            
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/dialogs/PreferencesDialog.js"></script>            
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/dialogs/ExternalContentDialog.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/dialogs/BuildGadgetDialog.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/dialogs/PublishGadgetDialog.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/dialogs/AddScreenDialog.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/dialogs/NewScreenflowDialog.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/dialogs/NewScreenDialog.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/dialogs/PreviewDialog.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/dialogs/TriggerDialog.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/dialogs/Alert.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/dialogs/Confirm.js"></script>

        <!-- Plans -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/plans/PlanPanel.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/plans/PlanSet.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/plans/PlanComponent.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/plans/PlanView.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/plans/PlanInstance.js"></script>
            
        <!-- Build -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/build/Builder.js"></script>        
        
        <!-- User account -->
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/user/User.js"></script>

        <!-- Miscelaneous utilities -->
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/utils/UIDGenerator.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/utils/BrowserUtils.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/utils/Utils.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/utils/Logger.js"></script>
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/utils/KeyPressRegistry.js"></script>
        <script type="text/javascript" 
            src="{{ MEDIA_URL }}js/gvs/utils/Geometry.js"></script>
                
        <!-- Constants -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/commons/Constants.js"></script>

        <!-- GVS Entry point -->
        <script type="text/javascript"
            src="{{ MEDIA_URL }}js/gvs/GVS.js"></script>
        
        <!-- We tell Dojo to load the needed modules -->
        <script type="text/javascript">
        /* <![CDATA[ */
            if (!browser.isIE()) {
                // We load Dojo's code relating to the needed components
                // ... typical UI Components
                dojo.require("dijit.form.Form");
                dojo.require("dijit.form.TextBox");
                dojo.require("dijit.form.ValidationTextBox");
                dojo.require("dijit.form.Button");
                dojo.require("dijit.Tooltip");
                dojo.require("dijit.MenuBar");
                dojo.require("dijit.MenuBarItem");
                dojo.require("dijit.PopupMenuBarItem");
                dojo.require("dijit.Menu");
                dojo.require("dijit.MenuItem");
                dojo.require("dijit.PopupMenuItem");
                dojo.require("dijit.Toolbar");
                dojo.require("dijit.ToolbarSeparator");
                
                // ... layouts used in page
                dojo.require("dijit.layout.AccordionContainer");
                dojo.require("dijit.layout.ContentPane");
                dojo.require("dijit.layout.TabContainer");
                dojo.require("dijit.layout.BorderContainer");
                dojo.require("dijit.Dialog");
    
                // ... other functions
                dojo.require("dojox.fx");
                
                // ... the parser
                dojo.require("dojo.parser");
    
                // Arming the GVS initialization method
                dojo.addOnLoad(function() {
                    GVSSingleton.getInstance().init();
                    // FIXME: there is a problem rendering the different
                    // sections programatically. Repaint for better
                    // performance
                    dijit.byId("main").layout();
                });
                
                // Handling navigator close
                window.onbeforeunload = function(evt) {
                    // TODO: call the server and save whatever necessary
                    var saved = true;
                    if (!saved) {
                        var message = 'Are you sure you want to leave?';
                        if (typeof evt == 'undefined') {
                            evt = window.event;
                        }
                        if (evt) {
                            evt.returnValue = message;
                        }
                        return message;
                    }
                }
                
                window.onunload = function() {
                    // Do something
                }               
            } else {
                // IE
                window.onload = function() {
                    document.getElementById("main").innerHTML = "";
                }
            }
        /* ]]> */
        </script>
    </head>

    <body class="soria">
        <!--[if IE]>
            <center>
            <p style="font-size: 24px;color:#243C5F;font-weight:bold">
                Your browser is still not supported, please download the latest version
            of Mozilla Firefox 
            </p>
            <a href="http://getfirefox.com/" title="Get Firefox - The Browser, Reloaded.">
            <img src="{{ MEDIA_URL }}images/gui/getfirefox.png" 
                border="0" alt="Get Firefox" 
                style="margin:20px auto 0; display: block;" />
            </a>
            </center>
        <![endif]-->
        <!-- Setting the layout of the page. --> 
        <div id="main" dojoType="dijit.layout.BorderContainer" 
                        liveSplitters="true" design="headline" splitter="true" gutter="true">           
            <!-- Header -->
            <div id="header" dojoType="dijit.layout.ContentPane" region="top">
                <img src="{{ MEDIA_URL }}images/gui/fastLogo_small.png" class="fastLogo" alt="FAST Logo"/>
                <div id="greeting"> 
                        <div>
                          {% if is_anonymous %}{% trans "anonymous" %}
                          </div> | <a href="/accounts/login/?next=/">{% trans "Sign in" %}</a>
                          {% else %} {% trans "Welcome" %}, {{ user.username }} | 
                          <a href="/logout">{% trans "Exit" %}</a></div>
                          {% endif %}
                </div>
                <!-- Menu area -->
                <div id="menu" dojoType="dijit.MenuBar">
                </div>
                <div id="toolbar" dojoType="dijit.Toolbar">
                </div>
            </div>
            
            <!-- Workspace area -->
            <div dojoType="dijit.layout.TabContainer" id="documentContainer" region="center">
            </div> 
            <!-- end of Document area -->
        </div>       
    </body>
</html>
<!-- vim: set ts=4 sw=4 et:  -->
