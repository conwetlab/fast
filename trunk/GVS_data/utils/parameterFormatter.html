<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <title>BuildingBlock parameter formatter</title>

        <style>
            textarea {
                width: 100%;
                height: 20em;
            }

            div {
                background: lightCoral;
                padding: 1em;
                border-radius: 10px;
                -moz-border-radius: 10px;
                border: 1px solid black;
                margin: 2em;
            }
            div.valid {
                background: lightGreen;
            }
        </style>
    </head>

    <body>
       <textarea id="json"></textarea>
       <button onclick="javascript:format();">Format</button>
    </body>

    <script>
        function formatParameterTemplate(template) {
            var json = template.replace(new RegExp('/\\*([^\\*]|\\*[^/])*\\*/', 'g'), '');
            json = json.replace(new RegExp('//[^\n\r]*', 'g'), '');

            var valid = true;
            try {
                JSON.parse(json);
            } catch (e) {
                valid = false;
            }

            return {
                'valid': valid,
                'text': template.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/'/g, "\\'").replace(/\n/g, '\\n').replace(/\r/g, '')
            };
        }

        var count = 1;

        function format() {
            var template = document.getElementById('json');

            var result = formatParameterTemplate(template.value);
            
            var div = document.createElement('div');
            if (result.valid) {
                div.className = "valid";
            }
            // "#" + count++;
            div.textContent = result.text;

            var bodyDivs = document.body.getElementsByTagName('div');
            if (bodyDivs)
                document.body.insertBefore(div, bodyDivs[0]);
            else
                document.body.appendChild(div);
        }
    </script>
</html>
